tyrano.plugin.kag.stat.running_key_event=[],$.key_event={pushEvent:function(e){switch(e.method){case"click":case"right_click":case"keydown":case"keyup":e.event=this.events[e.method];break;default:return console.error("[key_event] メソッドが正しく指定されていません"),!1}tyrano.plugin.kag.stat.running_key_event.push(e),this.resetEventAll(),this.startEventAll()},clearEvent:function(e){const t=tyrano.plugin.kag;if(this.resetEventAll(),e.reset)t.stat.running_key_event=[];else if(!e.all||e.name){if(!e.name)return console.error("[clear_key_event] nameが正しく指定されていません。"),!1;t.stat.running_key_event=t.stat.running_key_event.filter(t=>t!=e.name)}else t.stat.running_key_event=t.stat.running_key_event.filter(e=>!e.clear)},resetEventAll:function(){tyrano.plugin.kag.stat.running_key_event.forEach(e=>$(e.element).off())},startEventAll:function(){tyrano.plugin.kag.stat.running_key_event.forEach(e=>e.event(e))},events:{click:function(e){const t=$.key_event.events,n=t.getEventObject("click",e),o=t.getEmbParam(e);$(e.element).on(n.click,()=>t.embJump(...o.jump)),n.touchstart&&$(e.element).on(n.touchstart,()=>t.embJump(...o.jump)),t.commonEvent(n,e,o)},right_click:function(e){const t=$.key_event.events,n=t.getEventObject("right_click",e),o=t.getEmbParam(e);$(e.element).on(n.contextmenu,()=>t.embJump(...o.jump)),t.commonEvent(n,e,o)},keydown:function(e){const t=$.key_event.events,n=t.getEventObject("keydown",e),o=t.getEmbParam(e);$(e.element).on(n.keydown,n=>{n.keyCode==e.key_code&&t.embJump(...o.jump)}),t.commonEvent(n,e,o)},keyup:function(e){const t=$.key_event.events,n=t.getEventObject("keyup",e),o=t.getEmbParam(e);$(e.element).on(n.keyup,n=>{n.keyCode==e.key_code&&t.embJump(...o.jump)}),t.commonEvent(n,e,o)},commonEvent:function(e,t,n){const o=$.key_event.events;t.mouseout_exp&&$(t.element).on(e.mouseover,()=>o.embScript(...n.mouseover)),t.mouseout_exp&&$(t.element).on(e.mouseout,()=>o.embScript(...n.mouseout))},getEventObject:function(e,t){const n={mouseover:"mouseover."+t.name,mouseout:"mouseout."+t.name};switch(e){case"click":n.click="click."+t.name,"pc"!=$.userenv()&&(n.touchstart="touchstart."+t.name);break;case"right_click":n.contextmenu="contextmenu."+t.name;break;case"keydown":n.keydown="keydown."+t.name;break;case"keyup":n.keyup="keyup."+t.name}return n},getEmbParam:function(e){return{jump:[e.exp,e.preexp,e.storage,e.target],mouseover:[e.mouseover_exp,e.preexp],mouseout:[e.mouseout_exp,e.preexp]}},embScript:function(e,t){e&&tyrano.plugin.kag.embScript(e,t)},embJump:function(e,t,n,o){this.embScript(e,t),(n||o)&&tyrano.plugin.kag.ftag.startTag("jump",{storage:n,target:o})}},parseBoolean:function(e){return"true"==e},parseElement:function(e){return"window"===e?window:"document"===e?document:e}},tyrano.plugin.kag.tag.key_event={pm:{name:"event",clear:"true",method:"keydown",key_code:"13",element:"body",storage:null,target:null,exp:null,mouseover_exp:null,mouseout_exp:null,preexp:null},start:function(e){if("window"==e.element||"document"==e.element)return console.error(`[key_event] element属性に${e.element}は指定できません`),!1;e.clear=$.key_event.parseBoolean(e.clear),$.key_event.pushEvent(e),this.kag.ftag.nextOrder()}},tyrano.plugin.kag.tag.clear_key_event={pm:{name:null,element:"body",all:"true",reset:"false"},start:function(e){e.element=$.key_event.parseElement(e.element),e.all=$.key_event.parseBoolean(e.all),e.reset=$.key_event.parseBoolean(e.reset),$.key_event.clearEvent(e),this.kag.ftag.nextOrder()}},tyrano.plugin.kag.tag.make_key_event={start:function(e){const t=object(this.kag.stat.running_key_event);this.kag.stat.running_key_event=[],t.forEach(e=>$.key_event.pushEvent(e)),this.kag.ftag.nextOrder()}},["key_event","clear_key_event","make_key_event"].forEach(e=>{tyrano.plugin.kag.ftag.master_tag[e]=object(tyrano.plugin.kag.tag[e]),tyrano.plugin.kag.ftag.master_tag[e].kag=TYRANO.kag});